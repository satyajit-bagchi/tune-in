<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
	<title>Synth</title>

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="icon" type="image/png" sizes="174x174" href="./style/favicon.png">
  <script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>
	<script src="https://tonejs.github.io/build/Tone.js"></script>
	<script src="./scripts/jquery.min.js"></script>
	<script src="./scripts/draggabilly.js"></script>
	<script src="./scripts/StartAudioContext.js"></script>
	<script src="./scripts/Interface.js"></script>
	<script src="https://tonejs.github.io/Logo/build/Logo.js"></script>
	<script src="./scripts/Keyboard.js"></script>

	<link rel="stylesheet" type="text/css" href="./style/examples.css">

  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCK_7ygkDtQ05rfO7A70eeUXhYrVZHKLo4",
      authDomain: "test-9dc5d.firebaseapp.com",
      databaseURL: "https://test-9dc5d.firebaseio.com",
      projectId: "test-9dc5d",
      storageBucket: "test-9dc5d.appspot.com",
      messagingSenderId: "376834710960"
    };
    firebase.initializeApp(config);

    /* var bigOne = document.getElementById('bigOne');
    var dbRef = firebase.database().ref().child('text');
    dbRef.on('value', snap => bigOne.innerText = snap.val()); */
   var test;
  var dbRef = firebase.database().ref().child('test');
  dbRef.on('value', snapshot => {
    midi = snapshot.val();
    console.log(midi);
  });

  </script>


</head>
<body>
	<style type="text/css">
		img {
			width: 80%;
			max-width: 700px;
			margin-left: auto;
    		margin-right: auto;
    		display: block;
		}
		#Keyboard {
			margin: 3px!important;
		}
	</style>
	<div id="Content">
		<div id="Title">Synth</div>

		<div id="Keyboard"></div>
	</div>

	<script>
		var synth = new Tone.PolySynth(8).toMaster();
			/**{"oscillator" : {
				"type" : "amtriangle",
				"harmonicity" : 0.5,
				"modulationType" : "sine"
			},
			"envelope" : {
				"attackCurve" : 'exponential',
				"attack" : 0.05,
				"decay" : 0.2,
				"sustain" : 0.2,
				"release" : 1.5,
			},
			"portamento" : 0.05}
    ).toMaster();**/
    var midi = test;
  // make sure you set the tempo before you schedule the events
  Tone.Transport.bpm.value = midi.header.bpm
  // pass in the note events from one of the tracks as the second argument to Tone.Part
  var midiPart = new Tone.Part(function(time, note) {
    //use the events to play the synth
    synth.triggerAttackRelease(note.name, note.duration, time, note.velocity)
  }, midi.tracks[0].notes).start();
  // start the transport to hear the events
  Tone.Transport.start();
	</script>

</body>
</html>
