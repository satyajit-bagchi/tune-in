<html>
<button type="button" onclick="writeMelodyJson()">Click Me!</button>
<body>

    <h1 id="bigOne"></h1>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="icon" type="image/png" sizes="174x174" href="./style/favicon.png">

	<script src="https://tonejs.github.io/build/Tone.js"></script>
	<script src="./scripts/jquery.min.js"></script>
	<script src="./scripts/draggabilly.js"></script>
	<script src="./scripts/StartAudioContext.js"></script>
	<script src="./scripts/Interface.js"></script>
	<script src="https://tonejs.github.io/Logo/build/Logo.js"></script>
	<script src="./scripts/Keyboard.js"></script>

    <script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyD0cf2mNyPChLU8FAVUhgw2rwVsLjKYty8",
            authDomain: "tune-in-b3959.firebaseapp.com",
            databaseURL: "https://tune-in-b3959.firebaseio.com",
            projectId: "tune-in-b3959",
            storageBucket: "tune-in-b3959.appspot.com",
            messagingSenderId: "219762201728"
        };
        firebase.initializeApp(config);

        var dbRef = firebase.database().ref().child('midiwrite')
        dbRef.on('value', snapshot => {
            console.log('retrieving')
            console.log(snapshot.val())
            play(snapshot.val())
        });

        function play(midi) {
            var synth = new Tone.PolySynth(8).toMaster();
            // pass in the note events from one of the tracks as the second argument to Tone.Part
            var midiPart = new Tone.Part(function (time, note) {

                //use the events to play the synth
                synth.triggerAttackRelease(note.name, note.duration, time, note.velocity)

            }, midi.notes).start();

            //
            //start the transport to hear the events
            Tone.Transport.start();
        }

        function writeMelodyJson(melody){
          // Create an entry
          var postData = {
            "notes":[{
                "duration": "0.34999",
                "name": "D4",
                "time": "0"
              }
            ]// Get a key for a new Post.
          }
          firebase.database().ref().child('midiwrite').update(postData)

        }

        function foo(){
          console.log("Yo!")
        }

    </script>



</body>

</html>
